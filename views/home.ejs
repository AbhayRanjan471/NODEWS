 
<!-- <link rel="stylesheet" href="/css/layout.css"> -->

<h1>Codeial Abahy / <%= title %> </h1>

<section id="feed-posts">
        <h4>Post</h4>
        <!-- ristricting the form to be visible to an anonymous user , So that an anonymous user can't post comment , it will be displayed to only that user who have signed in -->
        <% if(locals.user){ %>
        <form action="/posts/create" id="new-post-form" method="POST">
                <textarea name="content" cols="30" rows="3" placeholder="Type Here..." required></textarea>
                <input type="submit" value="Post">
        </form>
                
        <% } %>
        

        <div id="posts-list-container">
           <ul style="list-style:none;">
                <!-- traversing over the posts data base -->
                <% for(post of posts){ %>
                 <li>
                    <p>
                        <!-- for deleting the post -->
                        <% if(locals.user && locals.user.id == post.user.id) { %>
                        <small>
                                <a href="/posts/destroy/<%= post.id %>">X</a>
                        </small>
                        <% } %>
                      <%= post.content %>
                      <br>
                      <small><%= post.user.name %></small>
                    </p>
                    <!-- for comment section creating the comment -->
                    <div class="post-comments">
                        <!-- check for authentication visible to only authenticated user only -->
                        <% if(locals.user){ %>
                                
                                <form action="/comments/create" method="POST">
                                        <input type="text" name="content" placeholder="Type Here to add comment..." required>
                                        <input type="hidden" name="post" value="<%= post._id %>">
                                        <input type="submit"  value="Add Comment"> 
                                </form>
                        <% } %>

                        <!-- loading the comments from the data base to the screen -->
                        <div class="post-comments-list">
                                <ul id="post-comments-<%= post._id %>">
                                        <% for(comment of post.comments){ %>
                                                <p>
                                                        <!-- for deleting the comments -->
                                                        <% if(locals.user && locals.user.id == comment.user.id ) { %>
                                                                <small>
                                                                        <a href="/comments/destroy/<%= comment.id %>">X</a>
                                                                </small>
                                                                <% } %>
                                                        <%= comment.content %>
                                                        <br>
                                                        <small>
                                                                <%= comment.user.name %>
                                                        </small>
                                                </p>
                                        <% } %>
                                </ul>
                        </div>
                        
                    </div>
                 </li>
                <% } %>
                
            </ul>
        </div>
</section>